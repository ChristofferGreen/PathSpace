# PathSpace — Status Snapshot (October 19, 2025)

This note captures the current state of the repository so the next AI assistant can resume quickly. Cross‑check the referenced docs for full context.

## Build & Testing
- Core compile helper: `./scripts/compile.sh --test --loop=1 --per-test-timeout 20`
- Metal presenter coverage (macOS): `./scripts/compile.sh --enable-metal-tests --test --loop=1 --per-test-timeout 20`
- Local pre-push hook now auto-enables Metal tests on macOS; use `DISABLE_METAL_TESTS=1` to skip when GPU access is unavailable.
- CI runs Linux matrix (core/app/software UI) plus macOS Metal job invoking the Metal tests.

## Metal Presenter & Diagnostics
- `PathWindowView` handles CAMetalLayer presents; Metal uploads gated by `PATHSPACE_ENABLE_METAL_UPLOADS`.
- `RenderSettings::surface.metal` and `SurfaceDesc::metal` carry storage mode, usage flags, and IOSurface backing preferences.
- `RenderSettings::renderer` captures the resolved backend and whether Metal uploads were active for the frame.
- Diagnostics persist `gpuEncodeMs`, `gpuPresentMs`, and backend info per present. See `docs/AI_Plan_SceneGraph_Renderer.md` for schema details.

## Testing Artifacts
- Metal UITest lives in `tests/ui/test_PathWindowView_Metal.mm`, gated by the Metal environment flag.
- Builders tests skip Metal-only assertions when uploads are enabled (covered by the UITest).
- Progressive presenter, builders, and renderer tests remain in `tests/ui/test_Builders.cpp`, `tests/ui/test_PathWindowView.cpp`, etc.

## Remaining Metal Phase Work
- `docs/SceneGraphImplementationPlan.md` Phase 7 follow-ups:
  - Expand renderer stats/diagnostics for GPU error paths (partially done; ensure error propagation is wired end-to-end).
  - Shader/material parity and GPU resource residency system are still TODO.

## Documentation Highlights
- `docs/AI_Onboarding.md` — updated immediate next steps (migrate remaining WindowEventPump scaffolding, wire Metal UITest into CI, document new metrics).
- `docs/AI_ARCHITECTURE.md` — reflects Metal-specific surface/render settings metadata.
- `docs/AI_Plan_SceneGraph_Renderer.md` — schemas include Metal descriptors, presenter metrics, and the renderer cache soft/hard byte fields.
- `docs/AI_TODO.task` — `WindowEventPump UI Migration [UI]` in progress, Metal presenter UITest task marked completed.

## Suggested Next Steps
1. Finish the Metal diagnostics bullet in Phase 7 (verify GPU error propagation and metrics coverage).
2. Begin the shader/material parity effort so Metal uploads emit the same material pipeline descriptors and telemetry as the software path.
3. Continue trimming `examples/macos/WindowEventPump.mm` down to input/event plumbing only.

Keep the looped test run green and update docs alongside code changes. Good luck!
