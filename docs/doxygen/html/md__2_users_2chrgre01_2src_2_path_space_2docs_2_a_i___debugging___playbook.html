<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PathSpace: Handoff Notice</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PathSpace
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__2_users_2chrgre01_2src_2_path_space_2docs_2_a_i___debugging___playbook.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Handoff Notice </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md64"></a></p>
<blockquote class="doxtable">
<p><b>Handoff note (October 19, 2025):</b> These troubleshooting steps remain accurate but assume the prior tooling defaults. Confirm any helper script changes in <span class="tt"><a class="el" href="_a_i___onboarding___next_8md.html">docs/AI_Onboarding_Next.md</a></span> before relying on this playbook. <b>Update (October 21, 2025):</b> Presenter telemetry now mirrors into window diagnostics sinks (<span class="tt">windows/&lt;win&gt;/diagnostics/metrics/live/views/&lt;view&gt;/present/*</span>); see §3 for usage. </p>
</blockquote>
<h1 class="doxsection"><a class="anchor" id="autotoc_md65"></a>
PathSpace — Debugging Playbook</h1>
<blockquote class="doxtable">
<p><b>Context update (October 18, 2025):</b> The test harness now captures detailed logs for every failure via <span class="tt">scripts/run-test-with-logs.sh</span>. Use this playbook to triage regressions, inspect diagnostics, and close the loop with the mandated 15× test runs. <b>Diagnostics refresh (October 19, 2025):</b> Dirty-rect hints are coalesced server-side, and the extended damage/fingerprint/progressive metrics are available when <span class="tt">PATHSPACE_UI_DAMAGE_METRICS=1</span>. Keep the flag unset during perf runs—the software encode pass is still single-threaded today, so we’re focusing on parallelising it next. </p>
</blockquote>
<p>This guide consolidates the practical steps for investigating failures across unit tests, UI targets, and runtime metrics. Pair it with the architecture docs (<span class="tt"><a class="el" href="_a_i___a_r_c_h_i_t_e_c_t_u_r_e_8md.html">docs/AI_Architecture.md</a></span>, <span class="tt"><a class="el" href="_plan___scene_graph___renderer_8md.html">docs/Plan_SceneGraph_Renderer.md</a></span>) when you need deeper background.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md66"></a>
1. Reproducing and Capturing Failures</h2>
<h3 class="doxsection"><a class="anchor" id="autotoc_md67"></a>
1.1 Standard looped test run</h3>
<div class="fragment"><div class="line">./scripts/compile.sh --test --loop=15 --per-test-timeout=20</div>
</div><!-- fragment --><ul>
<li>Runs both <span class="tt">PathSpaceTests</span> and <span class="tt">PathSpaceUITests</span> each iteration.</li>
<li>Logs land under <span class="tt">build/test-logs/</span> using the pattern <span class="tt">&lt;test&gt;_loop&lt;iteration&gt;of&lt;total&gt;_&lt;timestamp&gt;.log</span> if a failure occurs.</li>
<li><span class="tt">PATHSPACE_LOG</span> defaults to <span class="tt">1</span> in the helper so tagged logging is enabled when an error surfaces; adjust via <span class="tt">--env PATHSPACE_LOG=0</span> if you need silence.</li>
<li>Want to exercise the Metal presenter path locally? Append <span class="tt">--enable-metal-tests</span> (macOS only) so the helper sets <span class="tt">PATHSPACE_UI_METAL=ON</span> during configuration and runs the suites with <span class="tt">PATHSPACE_ENABLE_METAL_UPLOADS=1</span>.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md68"></a>
1.2 Single test reproduction</h3>
<p>Use doctest filters with the wrapper when isolating a case:</p>
<div class="fragment"><div class="line">./scripts/run-test-with-logs.sh \</div>
<div class="line">  --label PathSpaceTests.read \</div>
<div class="line">  --log-dir build/test-logs \</div>
<div class="line">  --timeout 20 \</div>
<div class="line">  -- \</div>
<div class="line">  ./build/tests/PathSpaceTests --test-case &quot;PathSpace read blocking&quot;</div>
</div><!-- fragment --><p>Environment knobs (all respected by the wrapper and the logger):</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Variable  </th><th class="markdownTableHeadNone">Purpose  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">PATHSPACE_LOG</span>  </td><td class="markdownTableBodyNone">Enable/disable log emission (truthy values: <span class="tt">1</span>, <span class="tt">true</span>, <span class="tt">on</span>, etc.).  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">PATHSPACE_LOG_ENABLE_TAGS</span>  </td><td class="markdownTableBodyNone">Comma-separated allowlist (e.g., <span class="tt">TEST,WAIT</span>).  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">PATHSPACE_LOG_SKIP_TAGS</span>  </td><td class="markdownTableBodyNone">Comma-separated blocklist.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">PATHSPACE_TEST_TIMEOUT</span>  </td><td class="markdownTableBodyNone">Millisecond poll interval for blocking tests (default <span class="tt">1</span>).  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">MallocNanoZone</span>  </td><td class="markdownTableBodyNone">Set to <span class="tt">0</span> to reduce allocation overhead on macOS (default from helper).  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">PATHSPACE_ENABLE_METAL_UPLOADS</span>  </td><td class="markdownTableBodyNone">Opt-in Metal texture uploads during UI tests; leave unset in CI/headless runs so builders fall back to the software raster.  </td></tr>
</table>
<h2 class="doxsection"><a class="anchor" id="autotoc_md69"></a>
2. Inspecting Collected Logs</h2>
<ol type="1">
<li>Open the saved log file (e.g., <span class="tt">build/test-logs/PathSpaceTests_loop3of15_20251018-161200.log</span>).</li>
<li>The tail section is also echoed to stderr at the time of failure; the full file includes tagged entries (<span class="tt">[TEST][INFO] …</span>) plus doctest progress markers.</li>
<li>When ASAN/UBSAN is enabled, the helper preserves the sanitizer output verbatim. Re-run with <span class="tt">PATHSPACE_ENABLE_CORES=1</span> to generate core dumps for deeper analysis.</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md70"></a>
3. PathSpace Runtime Diagnostics</h2>
<ul>
<li><b>Structured errors:</b> Renderer/presenter components publish <span class="tt">PathSpaceError</span> payloads under <span class="tt">renderers/&lt;rid&gt;/targets/&lt;tid&gt;/diagnostics/errors/live</span>. In tests, call <span class="tt">Diagnostics::ReadTargetMetrics</span> to fetch the payload and correlate with frame indices.</li>
<li><b>Per-target metrics:</b> <span class="tt">renderers/&lt;rid&gt;/targets/&lt;tid&gt;/output/v1/common/*</span> stores the latest <span class="tt">frameIndex</span>, <span class="tt">revision</span>, <span class="tt">renderMs</span>, progressive copy counters (including <span class="tt">progressiveTileSize</span>, <span class="tt">progressiveWorkersUsed</span>, <span class="tt">progressiveJobs</span>), encode fan-out stats (<span class="tt">encodeWorkersUsed</span>, <span class="tt">encodeJobs</span>), backend telemetry (<span class="tt">backendKind</span>, <span class="tt">usedMetalTexture</span>), GPU timings (<span class="tt">gpuEncodeMs</span>, <span class="tt">gpuPresentMs</span>), present policy outcomes, and—when <span class="tt">PATHSPACE_UI_DAMAGE_METRICS=1</span> is set—damage/fingerprint telemetry (<span class="tt">damageRectangles</span>, <span class="tt">damageCoverageRatio</span>, <span class="tt">fingerprint*</span>, <span class="tt">progressiveTiles*</span>). Use <span class="tt">PathWindowView</span> doctest helpers or the builders’ diagnostics reader to dump these values.</li>
<li><b>Window diagnostics sinks:</b> Presenter metrics mirror into <span class="tt">windows/&lt;win&gt;/diagnostics/metrics/live/views/&lt;view&gt;/present/*</span>, including frame indices, present/render timings, progressive counters, last error strings, and timestamps, so dashboards can monitor windows without crawling every renderer target. With <span class="tt">PATHSPACE_UI_DAMAGE_METRICS=1</span> the mirror also carries the tile-damage diagnostics (<span class="tt">progressiveTiles{Dirty,Total,Skipped}</span>, <span class="tt">progressiveTilesUpdated</span>, <span class="tt">progressiveBytesCopied</span>, encode worker/job counts) alongside the core progressive copy telemetry.</li>
<li><b>Scene dirty state:</b> <span class="tt">scenes/&lt;sid&gt;/diagnostics/dirty/state</span> and <span class="tt">scenes/&lt;sid&gt;/diagnostics/dirty/queue</span> expose layout/build notifications. The <span class="tt">Scene::MarkDirty</span> doctests show how to wait on these paths without polling.</li>
<li><b>HTML/IO logs:</b> Application surfaces write to <span class="tt">&lt;app&gt;/io/log/{error,warn,info,debug}</span>. The global mirrors live at <span class="tt">/system/io/std{out,err}</span>; see <span class="tt"><a class="el" href="_a_i___p_a_t_h_s_8md.html">docs/AI_Paths.md</a></span> §2 for the canonical layout.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md71"></a>
4. Workflow Checklist After a Failure</h2>
<ol type="1">
<li><b>Collect artifacts</b><ul>
<li>Inspect the saved log file(s) under <span class="tt">build/test-logs/</span>.</li>
<li>Preserve any core dumps or sanitizer traces (enable with <span class="tt">PATHSPACE_ENABLE_CORES=1</span> if needed).</li>
</ul>
</li>
<li><b>Correlate with diagnostics</b><ul>
<li>Query <span class="tt">diagnostics/errors/live</span> and <span class="tt">output/v1/common/*</span> for affected targets.</li>
<li>For scene issues, inspect <span class="tt">diagnostics/dirty/*</span> to confirm dirty markers and queues behave as expected.</li>
</ul>
</li>
<li><b>Isolate the regression</b><ul>
<li>Re-run the failing test with doctest filters and specific tags enabled (<span class="tt">PATHSPACE_LOG_ENABLE_TAGS=TEST,UI</span>).</li>
<li>Use <span class="tt">--loop=3</span> on the helper to confirm the fix eliminates intermittent races before scaling back to the mandated 15.</li>
</ul>
</li>
<li><b>Document findings</b><ul>
<li>Update the relevant plan doc (<span class="tt"><a class="el" href="_plan___scene_graph___implementation_8md.html">docs/Plan_SceneGraph_Implementation.md</a></span> or task entry) with repro steps, log references, and next actions.</li>
</ul>
</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md72"></a>
5. Tooling Quick Reference</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Task  </th><th class="markdownTableHeadNone">Command  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Run both suites once with logs  </td><td class="markdownTableBodyNone"><span class="tt">./scripts/compile.sh --test</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Run both suites 15× with 20 s timeout  </td><td class="markdownTableBodyNone"><span class="tt">./scripts/compile.sh --test --loop=15 --per-test-timeout=20</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Run suites once with Metal presenter enabled (macOS)  </td><td class="markdownTableBodyNone"><span class="tt">./scripts/compile.sh --enable-metal-tests --test</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Run a single suite via CTest  </td><td class="markdownTableBodyNone"><span class="tt">ctest --output-on-failure -R PathSpaceUITests</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Re-run failed tests only  </td><td class="markdownTableBodyNone"><span class="tt">ctest --rerun-failed --output-on-failure</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Verify HTML adapter command stream  </td><td class="markdownTableBodyNone"><span class="tt">ctest -R HtmlCanvasVerify --output-on-failure</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Verify HSAT asset inspection tooling  </td><td class="markdownTableBodyNone"><span class="tt">ctest -R HtmlAssetInspect --output-on-failure</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Inspect HSAT payload contents manually  </td><td class="markdownTableBodyNone"><span class="tt">./build/pathspace_hsat_inspect --input &lt;payload.hsat&gt;</span>  </td></tr>
</table>
<p>| Tail latest failure log | <span class="tt">ls -t build/test-logs | head -1 | xargs -I{} tail -n 80 build/test-logs/{}</span> | | Inspect renderer metrics path | <span class="tt">build/tests/PathSpaceUITests --test-case Diagnostics::ReadTargetMetrics</span> | | Benchmark damage/fingerprint metrics | <span class="tt">./build/benchmarks/path_renderer2d_benchmark --metrics [--canvas=WIDTHxHEIGHT]</span> | | Capture pixel-noise baseline JSON | <span class="tt">./scripts/capture_pixel_noise_baseline.sh</span> | | Check pixel-noise run against budgets | <span class="tt">python3 scripts/check_pixel_noise_baseline.py --build-dir build</span> |</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md73"></a>
5.1 Pixel Noise Perf Harness Baselines</h3>
<ul>
<li>Use <span class="tt">./scripts/capture_pixel_noise_baseline.sh</span> after rebuilding (<span class="tt">cmake --build build -j</span>) to refresh <span class="tt">docs/perf/pixel_noise_baseline.json</span>.</li>
<li>Pass <span class="tt">--backend=metal</span> (and export <span class="tt">PATHSPACE_ENABLE_METAL_UPLOADS=1</span>) to capture the Metal2D variant in <span class="tt">docs/perf/pixel_noise_metal_baseline.json</span>; commit both baselines together when budgets shift.</li>
<li>The helper launches <span class="tt">pixel_noise_example</span> headless with the standard perf budgets (≥50 FPS, ≤20 ms render/present) and records the run via <span class="tt">--write-baseline=&lt;path&gt;</span>.</li>
<li><span class="tt">python3 scripts/check_pixel_noise_baseline.py --build-dir build</span> reruns the harness with the recorded parameters, writes a temporary metrics snapshot, and fails if the averaged frame times exceed the stored budgets or if FPS dips below the baseline threshold. The script respects the baseline’s <span class="tt">backendKind</span>, forwarding the matching <span class="tt">--backend</span> flag and enabling Metal uploads automatically when needed. <span class="tt">PixelNoisePerfHarness</span> (software) and <span class="tt">PixelNoisePerfHarnessMetal</span> (Metal, PATHSPACE_UI_METAL builds) in CTest now go through the same script so regressions surface during the 15× loop.</li>
<li>Inspect the resulting JSON for:<ul>
<li><span class="tt">summary.*</span> — aggregate FPS and timing averages used to confirm budgets.</li>
<li><span class="tt">tileStats.*</span> — progressive tiling activity (tiles updated/dirty/skipped/copied, worker/job counts) for spotting regression hot spots.</li>
<li><span class="tt">residency.*</span> — mirrored metrics from <span class="tt">diagnostics/metrics/residency/*</span> so residency budget drifts surface during perf reviews.</li>
</ul>
</li>
<li>Pair the JSON with the console summary emitted by the example (<span class="tt">pixel_noise_example: summary …</span>) when reporting numbers in PRs.</li>
<li>Keep older baselines committed when behaviour intentionally shifts; diffing JSON across commits highlights the magnitude of a regression or improvement.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md74"></a>
6. Closing the Loop</h2>
<p>Always finish a debugging session by:</p>
<ol type="1">
<li>Re-running the full loop: <span class="tt">./scripts/compile.sh --test --loop=15 --per-test-timeout=20</span></li>
<li>Verifying no new logs were emitted (<span class="tt">find build/test-logs -type f -mmin -5</span> should be empty on success).</li>
<li>Recording the outcome (pass/fail, relevant paths, log snippets) in the working note or PR description for traceability.</li>
</ol>
<p>With the shared test runner and this playbook, every failure leaves behind actionable artifacts, keeping the UI/renderer hardening efforts measurable and repeatable.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md75"></a>
7. Current Blockers (October 20, 2025)</h2>
<ul>
<li>None. The HTML asset hydration failure was cleared on October 20, 2025 by introducing a dedicated <span class="tt">Html::Asset</span> serialization codec (<span class="tt">include/pathspace/ui/HtmlSerialization.hpp</span>) and a regression test (<span class="tt">Html::Asset vectors survive PathSpace round-trip</span>). Reconfirm with <span class="tt">ctest --test-dir build --output-on-failure -R "Html::Asset"</span> or the full <span class="tt">PathSpaceUITests</span> loop when touching the renderer stack. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
