<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PathSpace: Handoff Notice</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PathSpace
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__2_users_2chrgre01_2src_2_path_space_2docs_2_plan___web_server___adapter.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Handoff Notice </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md329"></a></p>
<blockquote class="doxtable">
<p><b>Drafted:</b> October 20, 2025 — initial plan for the embedded PathSpace web server. <b>Audience:</b> PathSpace maintainers implementing HTML delivery for web clients and coordinating dual native/web app flows. </p>
</blockquote>
<h1 class="doxsection"><a class="anchor" id="autotoc_md330"></a>
PathSpace Web Server Adapter Plan</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md331"></a>
Goals</h2>
<ul>
<li>Serve PathSpace applications (paint, widgets, PDF reader, health dashboard, etc.) to web browsers using the existing HTML adapter outputs (<span class="tt">output/v1/html/*</span>) and canonical path conventions.</li>
<li>Support native and web delivery from the same PathSpace app definition so producers maintain one code path.</li>
<li>Provide a minimal, secure HTTP interface that maps URLs to PathSpace paths, manages user authentication, and optionally streams live updates.</li>
<li>Remain lightweight enough for local development while allowing scale-out in hosted deployment.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md332"></a>
Non-Goals (v1)</h2>
<ul>
<li>Full multi-tenant rate limiting and quota enforcement (capture TODOs for later).</li>
<li>Cross-origin federation or third-party OAuth (assume single origin, first-party login).</li>
<li>Serving arbitrary binary blobs outside the renderer/asset namespaces (stick to documented outputs).</li>
<li>Hot code reload for callables/executions; focus on serving rendered HTML assets.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md333"></a>
Architecture Overview</h2>
<div class="fragment"><div class="line">Browser ──HTTP(S)──&gt; Web Server Adapter ──PathSpace Client API──&gt; PathSpace Instance</div>
<div class="line">                                     │                             │</div>
<div class="line">                                     │                             ├─ Renderers/Scenes (native + HTML)</div>
<div class="line">                                     └─ Static Asset Cache ◀───────┘</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md334"></a>
Components</h3>
<ul>
<li><b>Web Server Adapter</b> — process exposing HTTP/S, translating requests to PathSpace path operations. Recommended implementation: lightweight HTTP server with no external web frameworks for prototyping, with production targeting a native C++ implementation.</li>
<li><b>PathSpace Client API</b> — lightweight binding (C++ CLI, IPC, or gRPC-style protocol) used by the server to read from the PathSpace tree, trigger renders, and subscribe to notifications.</li>
<li><b>Static Asset Cache</b> — folder or in-memory cache that mirrors <span class="tt">output/v1/html/assets/*</span> and per-app <span class="tt">resources/</span> entries for fonts/images.</li>
<li><b>Browser Client</b> — receives HTML/JS/CSS, optionally listens to Server-Sent Events (SSE) or WebSocket notifications for live updates.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md335"></a>
Native/Web Parity Strategy</h3>
<ul>
<li>Applications author scenes, renderers, and presenters once under app-relative paths.</li>
<li>Native desktop apps consume software/Metal outputs (<span class="tt">output/v1/common</span>, framebuffer, textures).</li>
<li>Web clients consume HTML outputs from the same renderer target.</li>
<li>Shared logic (state updates, ops inboxes) stays in PathSpace; UI differences live in adapters (native presenter vs. web adapter).</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md336"></a>
Request Lifecycle</h2>
<ol type="1">
<li><b>Authenticate</b> — Browser posts credentials to <span class="tt">/login</span>. Server validates and creates a session linked to a PathSpace user root (<span class="tt">/users/&lt;user&gt;/system/applications/&lt;app&gt;</span>). Set HTTP-only session cookie.</li>
<li><b>Resolve App</b> — Browser requests <span class="tt">/apps/&lt;app&gt;/&lt;view&gt;</span>. Server:<ul>
<li>Maps <span class="tt">&lt;app&gt;</span> to PathSpace app root.</li>
</ul>
</li>
</ol>
<p>Resolves <span class="tt">&lt;view&gt;</span> to a renderer target (e.g., <span class="tt">renderers/html/targets/apps/&lt;view&gt;</span>).</p><ul>
<li>Ensures the renderer has a fresh revision; optionally call <span class="tt">render</span> execution when <span class="tt">auto_render_on_present</span> is disabled.</li>
</ul>
<p><b>Gather Artifacts</b></p><ul>
<li>Read <span class="tt">output/v1/html/dom</span>, <span class="tt">css</span>, <span class="tt">commands</span>, <span class="tt">js</span>, <span class="tt">assets/*</span>.</li>
<li>Read metadata (<span class="tt">output/v1/common/*</span>) to embed frame indices, revision, present policy, backend info.</li>
<li>Collect asset fingerprints (<span class="tt">resources/html/&lt;hash&gt;</span>).</li>
</ul>
<p><b>Respond</b></p><ul>
<li>Serve <span class="tt">index.html</span> template injecting DOM, linking CSS/JS, and referencing asset URLs via fingerprint-based paths (<span class="tt">/assets/&lt;hash&gt;</span>).</li>
<li>Set cache headers (ETag = revision hash, <span class="tt">Cache-Control: private, max-age=30</span> by default).</li>
</ul>
<p><b>Live Updates (optional)</b></p><ul>
<li>SSE endpoint <span class="tt">/apps/&lt;app&gt;/&lt;view&gt;/events</span> watches <span class="tt">output/v1/common/frameIndex</span> and pushes new revision IDs.</li>
<li>Browser reloads partial DOM via fetch or full page refresh based on adapter mode.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md337"></a>
URL Mapping</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">HTTP Path  </th><th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">PathSpace Source  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">/login</span> (POST)  </td><td class="markdownTableBodyNone">Authenticate user, establish session  </td><td class="markdownTableBodyNone">Backed by application-specific auth (external service or PathSpace paths)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">/apps/&lt;app&gt;/&lt;view&gt;</span>  </td><td class="markdownTableBodyNone">Rendered HTML page  </td><td class="markdownTableBodyNone"><span class="tt">renderers/&lt;rid&gt;/targets/html/&lt;view&gt;/output/v1/html/dom</span> (and companions)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">/assets/&lt;app&gt;/&lt;fingerprint&gt;</span>  </td><td class="markdownTableBodyNone">Fingerprinted static asset (fonts, images)  </td><td class="markdownTableBodyNone"><span class="tt">renderers/&lt;rid&gt;/targets/html/&lt;view&gt;/output/v1/html/assets/&lt;fingerprint&gt;</span> or app <span class="tt">resources/</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">/api/path/&lt;encoded-path&gt;</span>  </td><td class="markdownTableBodyNone">(Optional) JSON API to read PathSpace nodes  </td><td class="markdownTableBodyNone">Direct <span class="tt">read</span> with permission checks; returns JSON  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">/apps/&lt;app&gt;/&lt;view&gt;/events</span>  </td><td class="markdownTableBodyNone">Live update stream (SSE/WebSocket)  </td><td class="markdownTableBodyNone">Watch <span class="tt">output/v1/common</span> for revision changes  </td></tr>
</table>
<h2 class="doxsection"><a class="anchor" id="autotoc_md338"></a>
Session &amp; Security</h2>
<ul>
<li><b>Session Store</b> — In-memory for dev; pluggable (Redis) for production. Store <span class="tt">user_id</span>, <span class="tt">app_root</span>, <span class="tt">permissions</span>.</li>
<li><b>Authorization</b> — Before touching PathSpace, verify <span class="tt">requested_path</span> is under <span class="tt">app_root</span>. Reject cross-app or system-level paths.</li>
<li><b>CSRF</b> — Standard token for <span class="tt">POST</span>/<span class="tt">PUT</span> routes; GET routes serve content only.</li>
<li><b>Transport</b> — Native server must support HTTPS (TLS termination) using configured certificates; allow HTTP only for local development/testing.</li>
<li><b>Command Execution</b> — Limit or sandbox PathSpace <span class="tt">insert</span>/<span class="tt">take</span> operations triggered via HTTP to avoid long-running tasks or arbitrary code. Consider a whitelist of allowed executions (e.g., <span class="tt">render</span>, <span class="tt">mark_dirty</span>).</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md339"></a>
Asset Pipeline</h2>
<ul>
<li>Extend renderer pipeline to publish:<ul>
<li><span class="tt">output/v1/html/assets/&lt;fingerprint&gt;</span> binaries.</li>
<li><span class="tt">output/v1/html/manifest.json</span> (adapter config, dependencies, revision hash).</li>
<li><span class="tt">resources/&lt;app&gt;/&lt;fingerprint&gt;</span> for shared assets (fonts/images) outside a specific view.</li>
</ul>
</li>
<li>Server caches assets in memory/disk using fingerprint as key; send <span class="tt">Cache-Control: public, max-age=31536000, immutable</span>.</li>
<li>Provide a background job to prefetch assets when a new revision lands (avoid latency spikes on first HTTP request).</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md340"></a>
Live Update Strategy</h2>
<ul>
<li>Subscribe to PathSpace notifications on:<ul>
<li><span class="tt">renderers/&lt;rid&gt;/targets/html/&lt;view&gt;/output/v1/common/frameIndex</span></li>
<li><span class="tt">diagnostics/errors/live</span></li>
<li><span class="tt">renderers/&lt;rid&gt;/targets/html/&lt;view&gt;/events/renderRequested/queue</span> (optional)</li>
</ul>
</li>
<li>On new frame, SSE push <span class="tt">{ revision, frameIndex, timestamp }</span>.</li>
<li>Browser JS decides whether to:<ul>
<li>Fetch updated DOM/CSS (for <span class="tt">AlwaysLatestComplete</span>).</li>
<li>Diff <span class="tt">commands</span> / re-run canvas replay.</li>
<li>Display error banners if diagnostics report issues.</li>
</ul>
</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md341"></a>
Native/Web Coexistence</h2>
<ul>
<li><b>Shared State Paths</b> — Keep application state under <span class="tt">apps/&lt;app&gt;/state/*</span>. Native and web presenters both react to PathSpace changes.</li>
<li><b>Renderer Targets</b> — For each view, define both:<ul>
<li><span class="tt">renderers/&lt;rid&gt;/targets/surfaces/&lt;view&gt;</span> (native framebuffer).</li>
<li><span class="tt">renderers/&lt;rid&gt;/targets/html/&lt;view&gt;</span> (HTML adapter).</li>
</ul>
</li>
<li><b>Present Policies</b> — Native windows use configured policy; HTML always uses <span class="tt">AlwaysLatestComplete</span>. Document in <span class="tt"><a class="el" href="_plan___scene_graph___renderer_8md.html">docs/Plan_SceneGraph_Renderer.md</a></span>.</li>
<li><b>Input/Interaction</b> — Web clients post events to <span class="tt">ops/</span> inbox paths via HTTP APIs; native clients use local PathSpace insertions. Ensure server exposes minimal REST endpoints to translate browser events into PathSpace operations (e.g., <span class="tt">/api/path/&lt;path&gt;</span> POST to insert an event).</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md342"></a>
Authentication &amp; Sessions</h2>
<ul>
<li><b>Credential source:</b> default to PathSpace-backed credentials under <span class="tt">/system/auth/users/&lt;user&gt;</span> storing salted/bcrypt hashes; allow configuration for external IdPs later.</li>
<li><b>Session payload:</b> <span class="tt">{ session_id, user_id, app_root, csrf_token, issued_at, expires_at }</span> persisted in-memory for dev or via Redis/SQLite adapters.</li>
<li><b>Expiry &amp; rotation:</b> 30-minute inactivity timeout, 8-hour absolute max; rotate session ID after login and privileged operations. Logout drops session and emits <span class="tt">sessions/&lt;id&gt;/invalidated</span>.</li>
<li><b>Per-request checks:</b> middleware validates cookie signature, checks expiry, and ensures requested path stays under <span class="tt">app_root</span>. On failure return 401 with generic message and log event.</li>
<li><b>Google Sign-In:</b> Optional OAuth 2.0 (Authorization Code + PKCE) adapter. Configure <span class="tt">client_id</span>, <span class="tt">client_secret</span>, <span class="tt">redirect_uri</span> via <span class="tt">[auth.google]</span> in <span class="tt">web_server.toml</span>. Callback verifies ID token signature/audience, maps Google <span class="tt">sub</span> to PathSpace user entry (<span class="tt">/system/auth/oauth/google/&lt;sub&gt;</span>), and falls back if user unrecognized. Store minimal token data (ID token only) and reuse existing session issuance on success.</li>
<li><b>Logout effects:</b> When a session ends (explicit logout, timeout, or connection drop), close any associated distributed mounts so the underlying PathSpace applications enter their shutdown flow. Require a fresh login/mount before resuming work.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md343"></a>
Deployment Models</h2>
<ul>
<li><b>Embedded:</b> Web server linked inside the PathSpace process for low-latency local use.</li>
<li><b>Sidecar:</b> Separate process communicating over Unix domain socket or gRPC; PathSpace exposes a lightweight RPC for <span class="tt">read/insert/render</span>.</li>
<li><b>Cluster:</b> Multiple stateless web frontends behind reverse proxy (NGINX/Envoy) with TLS termination, PathSpace workers behind service mesh. HTML bundles shared via object store (e.g., S3) or replicated disk.</li>
<li>Provide <span class="tt">web_server.toml</span> describing mode, listen address, TLS certificates/keys (for native HTTPS), session store adapter, and logging level.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md344"></a>
Reverse Proxy / NGINX Integration</h2>
<ul>
<li>Production deployments are expected to sit behind NGINX (or a similar reverse proxy) for TLS, load balancing, and buffering control.</li>
<li>Recommended settings:<ul>
<li>Preserve client information: <span class="tt">proxy_set_header Host $host; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme;</span>.</li>
<li>Disable buffering for SSE: &lsquo;proxy_buffering off; proxy_cache off; proxy_set_header Connection &rsquo;';<span class="tt"> so events stream without delay.</span></li>
<li><span class="tt">Extend timeouts for long-lived streams: </span>proxy_read_timeout 120s; proxy_send_timeout 120s;<span class="tt"> (tune per deployment).</span></li>
<li><span class="tt">Prep for WebSocket upgrades (future): </span>proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection "upgrade";<span class="tt">.</span></li>
<li><span class="tt">Enforce request size limits consistent with server policy (</span>client_max_body_size 4m;<span class="tt"> configurable).</span></li>
<li><span class="tt">Enable gzip/deflate for HTML/CSS/JS, but exclude SSE endpoints (</span>gzip_types text/html text/css application/javascript; gzip_proxied any;<span class="tt">).</span></li>
</ul>
</li>
<li><span class="tt">Document health check usage (</span>/api/healthz`) and example NGINX snippets so developers can drop the server behind a proxy with minimal friction.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md345"></a>
API Surface</h2>
<ul>
<li>Note: once JSON serialization support lands (see plan &amp; backlog), <span class="tt">/api/path</span> and SSE updates will use the shared JSON encoder for consistent output across web/debug tooling.</li>
<li><b>Static routes:</b> <span class="tt">/apps/&lt;app&gt;/&lt;view&gt;</span>, <span class="tt">/assets/&lt;app&gt;/&lt;fingerprint&gt;</span>, <span class="tt">/apps/&lt;app&gt;/&lt;view&gt;/events</span>.</li>
<li><b>REST:</b><ul>
<li><span class="tt">GET /api/path/&lt;encoded&gt;</span> → JSON snapshot (value, children) with permission filtering.</li>
<li><span class="tt">POST /api/path/&lt;encoded&gt;</span> → Insert/update; payload validated against allowlist under <span class="tt">app_root/config/web_api_allowlist</span>.</li>
<li><span class="tt">POST /api/ops/&lt;op&gt;</span> → Enqueue operation into <span class="tt">ops/&lt;op&gt;/inbox</span> (JSON body with schema version).</li>
<li><span class="tt">GET /api/healthz</span> (liveness) / <span class="tt">GET /api/readyz</span> (PathSpace connectivity).</li>
</ul>
</li>
<li><b>Error contract:</b> JSON <span class="tt">{ "error": { "code": "...", "message": "..." } }</span>, mapping PathSpace errors to HTTP status codes.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md346"></a>
Security &amp; Hardening</h2>
<ul>
<li>Force HTTPS (redirect HTTP) outside dev. Provide helper script for dev certificates.</li>
<li>Use HTTP-only, Secure cookies with SameSite=Lax (configurable). Store CSRF token per session and require header <span class="tt">X-CSRF-Token</span> on mutating requests.</li>
<li>Content-Security-Policy baseline: &lsquo;default-src 'self&rsquo;; img-src 'self' data:; script-src 'self'; style-src 'self' 'unsafe-inline'<span class="tt">.</span></li>
<li><span class="tt">Enforce payload size limits (1 MB default) and token-bucket rate limiting per IP + per session. Log suspicious activity to </span>app_root/io/log/security`.</li>
<li>Optionally mount the user-facing subtree through a throttling PathSpace adapter that forwards calls to the real app while tracking request rates; when thresholds are exceeded it introduces delays or temporary denials.</li>
<li>Maintain allowlist of permitted PathSpace executions; reject and audit any disallowed invocation attempts.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md347"></a>
Asset &amp; Cache Strategy</h2>
<ul>
<li>Fingerprint assets with SHA-256 and serve from <span class="tt">/assets/&lt;app&gt;/&lt;hash&gt;</span> using <span class="tt">Cache-Control: public, max-age=31536000, immutable</span>.</li>
<li>DOM/CSS/JS responses include ETag (revision hash) and <span class="tt">Last-Modified</span>; honor conditional requests to reduce bandwidth.</li>
<li>Prewarm bundles by watching <span class="tt">output/v1/html/common/frameIndex</span> and copying outputs into a staging directory, then atomically swapping symlinks the server serves from.</li>
<li>Optional CDN: allow rewriting asset URLs via config <span class="tt">cdn_base_url</span>; fallback to local serving when unset.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md348"></a>
Live Update Protocol</h2>
<ul>
<li>Use Server-Sent Events for v1. Message payload: <div class="fragment"><div class="line">{ &quot;type&quot;: &quot;frame&quot;, &quot;revision&quot;: 42, &quot;frameIndex&quot;: 128, &quot;timestamp&quot;: &quot;2025-10-20T15:04:05Z&quot; }</div>
</div><!-- fragment --> additional types: <span class="tt">"diagnostic"</span> (last error), <span class="tt">"reload"</span> (schema change).</li>
<li>Clients debounce fetches (≥100 ms) and re-fetch DOM on reconnect. Reconnect strategy: exponential backoff capped at 5 s with jitter.</li>
<li>Track missed revisions by storing last served revision in session; if gap detected, send <span class="tt">"reload"</span> message forcing full refresh.</li>
<li>Document WebSocket upgrade path for future bi-directional features (input streaming, logs).</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md349"></a>
Testing &amp; Tooling</h2>
<ul>
<li>Integration harness (<span class="tt">scripts/test_web_server.sh</span>) spins up PathSpace fixtures, runs the server, executes headless browser tests (Playwright/Puppeteer) to validate renders, SSE refresh, auth, asset caching.</li>
<li>Provide mock PathSpace client for unit testing handlers without full engine.</li>
<li>Developer workflow: <span class="tt">npm run serve-html</span> (or <span class="tt">./scripts/run_dev_web_server.sh</span>) plus automatic bundle export (<span class="tt">./scripts/export_html_example.py --watch</span>). Document in README.</li>
<li>Update <span class="tt"><a class="el" href="_a_i___debugging___playbook_8md.html">docs/AI_Debugging_Playbook.md</a></span> with log paths (<span class="tt">app_root/io/log/web</span>, <span class="tt">.../security</span>) and troubleshooting checklist.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md350"></a>
Observability</h2>
<ul>
<li>Metrics: request latency histogram, SSE connection count, render trigger latency, cache hit rate, auth failures, rate-limit rejections. Expose optional <span class="tt">/metrics</span> endpoint (Prometheus).</li>
<li>Structured logs (JSON): <span class="tt">{ ts, level, route, status, latency_ms, session_id?, user_id?, message }</span>.</li>
<li>Tie into PathSpace diagnostics by relaying <span class="tt">diagnostics/errors/live</span> to logs/SSE clients.</li>
<li>Establish alert thresholds (e.g., 5xx &gt; 1% for 5 min, SSE disconnect spikes).</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md351"></a>
Extensibility &amp; Configuration</h2>
<ul>
<li><span class="tt">web_server.toml</span> sections: <span class="tt">[server]</span>, <span class="tt">[paths]</span>, <span class="tt">[assets]</span>, <span class="tt">[security]</span>, <span class="tt">[apps.&lt;app&gt;]</span> (per-app overrides: renderer target IDs, allowed REST paths, SSE options).</li>
<li>Allow middleware plugins (analytics, custom auth) registered via config. Provide stable hook interface (request/response interceptors).</li>
<li>Document onboarding for new apps: configure renderer target, export HTML outputs, add entry to config with optional route aliases.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md352"></a>
Implementation Phases</h2>
<ol type="1">
<li><b>Phase 0 — Prototype (local only)</b><ul>
<li>Implement prototype HTTP server (<span class="tt">tools/serve_html</span> — a small standalone C++ binary) with <span class="tt">/apps/&lt;app&gt;/&lt;view&gt;</span> route using only the standard library / PathSpace utilities to stand up the HTML adapter quickly.</li>
<li>No auth; assume single developer session.</li>
<li>Serve paint/widgets examples by reading from <span class="tt">output/v1/html</span>.</li>
<li>Document setup in this plan.</li>
</ul>
</li>
<li><b>Phase 1 — Session &amp; Static Assets</b><ul>
<li>Add simple username/password auth stored in PathSpace or config.</li>
<li>Serve assets via <span class="tt">/assets/&lt;fingerprint&gt;</span> with cache headers.</li>
<li>Write integration tests (e.g., curl scripts or a C++ test harness) to assert correct responses.</li>
</ul>
</li>
<li><b>Phase 2 — Live Updates &amp; Error Handling</b><ul>
<li>Add SSE endpoint for revision changes.</li>
<li>Browser client updates canvas/DOM without full reload.</li>
<li>Surface diagnostics (<span class="tt">diagnostics/errors/live</span>) in UI.</li>
</ul>
</li>
<li><b>Phase 3 — Dual Native/Web Support</b><ul>
<li>Ensure state mutations triggered from web reflect in native views (and vice versa) by standardizing ops endpoints.</li>
<li>Extend examples to demonstrate native window + browser running simultaneously.</li>
</ul>
</li>
<li><b>Phase 4 — Hardened Deployment</b><ul>
<li>Add pluggable session store, HTTPS termination guidance.</li>
<li>Document scaling options (multiple web servers reading from shared PathSpace).</li>
<li>Add rate limiting hooks (middleware) and audit logging (PathSpace or external log).</li>
</ul>
</li>
</ol>
<p><b>Phase 5 — Observability &amp; Tooling</b></p><ul>
<li>Instrument metrics/logging, expose <span class="tt">/metrics</span>, and integrate with existing dashboards.</li>
<li>Land end-to-end tests for auth expiry, SSE reconnect, asset caching headers.</li>
<li>Update <span class="tt"><a class="el" href="_a_i___debugging___playbook_8md.html">docs/AI_Debugging_Playbook.md</a></span> with web server troubleshooting.</li>
</ul>
<p><b>Phase 6 — External IdP Integration</b></p><ul>
<li>Implement Google Sign-In adapter (PKCE flow) using configured client credentials.</li>
<li>Add automated tests mocking Google's OAuth endpoints and token responses.</li>
<li>Document setup steps (Google Cloud Console registration, redirect URIs) and failure handling in this plan and the debugging playbook.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md353"></a>
Required Updates Elsewhere</h2>
<ul>
<li><span class="tt"><a class="el" href="_plan___scene_graph___renderer_8md.html">docs/Plan_SceneGraph_Renderer.md</a></span> — Reference this plan; document the HTML server’s role.</li>
<li><span class="tt"><a class="el" href="_a_i___a_r_c_h_i_t_e_c_t_u_r_e_8md.html">docs/AI_Architecture.md</a></span> — Add note under HTML adapter about server delivery.</li>
<li><span class="tt"><a class="el" href="_a_i___debugging___playbook_8md.html">docs/AI_Debugging_Playbook.md</a></span> — Include troubleshooting steps for web server logs/SSE.</li>
<li><span class="tt">docs/AI_Todo.task</span> — Log implementation steps with priorities.</li>
<li>Example README(s) — Add instructions for launching the server and visiting the browser demo.</li>
</ul>
<blockquote class="doxtable">
<p><b>Dependency:</b> Remote deployments assume distributed mounts per <span class="tt"><a class="el" href="_plan___distributed___path_space_8md.html">docs/Plan_Distributed_PathSpace.md</a></span> so the web server can reach user app roots securely. </p>
</blockquote>
<h2 class="doxsection"><a class="anchor" id="autotoc_md354"></a>
Open Questions</h2>
<ul>
<li><b>API Transport</b> — Evaluate when we will need HTTP/2 or gRPC layering on top of the native C++ HTTP server (e.g., for sidecar/cluster deployments).</li>
<li><b>Incremental HTML Updates</b> — Finalize the JSON diff/event model and fallback strategy for streaming DOM updates.</li>
<li><b>Session Tooling</b> — Decide how developers manage auth sessions (CLI helpers, inspection endpoints) without introducing duplicative configuration.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md355"></a>
Next Actions</h2>
<ol type="1">
<li>Create <span class="tt">tools/serve_html</span> prototype (small C++ HTTP server with no external frameworks) to serve HTML outputs during development.</li>
<li>Define session/auth middleware (bcrypt hashing, cookie handling) and document configuration in <span class="tt">web_server.toml</span>.</li>
<li>Extend paint/widgets examples with <span class="tt">--export-html</span> flag producing HTML bundles (dom/css/js/assets).</li>
<li>Implement SSE endpoint with reconnection handling; add headless tests verifying refresh + diagnostics events.</li>
<li>Add integration tests executing server → PathSpace → browser flow (headless fetch) verifying 200 responses, auth gate, and caching headers.</li>
<li>Update documentation references, add TODO entries for the phases above. </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
