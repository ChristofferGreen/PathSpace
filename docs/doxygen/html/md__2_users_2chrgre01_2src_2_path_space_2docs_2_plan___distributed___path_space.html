<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PathSpace: Handoff Notice</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PathSpace
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__2_users_2chrgre01_2src_2_path_space_2docs_2_plan___distributed___path_space.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Handoff Notice </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md131"></a></p>
<blockquote class="doxtable">
<p><b>Drafted:</b> October 20, 2025 — initial plan for distributed PathSpace mounts and networking. </p>
</blockquote>
<h1 class="doxsection"><a class="anchor" id="autotoc_md132"></a>
PathSpace — Distributed Mount Plan</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md133"></a>
Goals</h2>
<ul>
<li>Allow one PathSpace instance (“client”) to mount another remote instance (“server”) under a local subtree, similar to mounting a network filesystem.</li>
<li>Preserve PathSpace semantics (atomic inserts, wait/notify, immutable snapshots, diagnostics) across network boundaries with predictable consistency and latency.</li>
<li>Provide secure, authenticated connections suitable for multi-user environments (per-user roots, ACL enforcement).</li>
<li>Serve as the foundation for remote HTML presentation, external tooling, and multi-machine coordination.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md134"></a>
Non-Goals (v1)</h2>
<ul>
<li>Conflict resolution for concurrent writers to the same remote path (first version assumes single writer per mounted subtree).</li>
<li>WAN-optimized replication or offline operation (focus on LAN / data-center latency).</li>
<li>Cross-version protocol negotiation beyond a rolling window (assume server and client are upgraded roughly together; document compatibility window).</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md135"></a>
Architecture Overview</h2>
<div class="fragment"><div class="line">Local PathSpace (client) ── RPC/stream ── Remote PathSpace (server)</div>
<div class="line">        │                                         │</div>
<div class="line">  mount /remote/app/…                      export /users/&lt;user&gt;/system/applications/&lt;app&gt;</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md136"></a>
Components</h3>
<ul>
<li><b>Mount Manager (client)</b> — handles mount configuration, maintains connection/session, translates local operations to RPC calls, and merges remote updates into the local trie namespace (JSON serialization support will enable debug views).</li>
<li><b>Export Manager (server)</b> — authenticates clients, enforces ACLs, and serves requests (read/insert/take, wait, snapshot stream, diagnostics). Manages subscriptions for wait/notify.</li>
<li><b>Protocol Layer</b> — transports RPCs and streaming updates over standalone Asio-based networking (aligning with the C++ Networking TS trajectory). Layer protobuf or Cap’n Proto schemas on top, including streaming for notifications and snapshot chunks.</li>
<li><b>Security Layer</b> — mutual TLS with client certificates or token-based auth (e.g., OAuth2 access tokens scoped to exported subtrees).</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md137"></a>
Mount Semantics</h2>
<ul>
<li><b>Read/Insert/Take</b> — operations within mounted subtree forward to server. Results (values, errors) mirror local semantics.</li>
<li><b>Wait/Notify</b> — register waits on remote server; server streams notifications to client, which wakes local waiters.</li>
<li><b>Snapshots</b> — remote <span class="tt">output/v1/*</span> files fetched lazily or via streaming channel. Consider caching to reduce bandwidth.</li>
<li><b>Diagnostics</b> — mirror <span class="tt">diagnostics/errors/live</span>, metrics, logs under the mounted subtree.</li>
<li><b>Shutdown</b> — clean unmount on disconnect; client clears cached nodes and wakes waiters with error status.</li>
<li><b>Single-writer assumption:</b> One logical writer per mounted subtree; clients coordinate out-of-band to avoid conflicts.</li>
<li><b>Atomic operations:</b> Each insert/read/take spans a single RPC. For batch inserts, use server-side transaction to maintain atomicity.</li>
<li><b>Latency:</b> Client operations block until server responds; configure timeouts and expose metrics.</li>
<li><b>Caching:</b> Optional read-cache for immutable paths (e.g., snapshots). Cache invalidation triggered by server notifications.</li>
<li><b>Failure handling &amp; logout semantics:</b> If the connection drops or the client logs out, treat it as session termination. The server tears down the mount, notifies remote applications to enter their shutdown flow, and releases resources. Any subsequent access requires a fresh <span class="tt">MountOpen</span> (no automatic resume). Distinguish between graceful close vs. abrupt drop in logs/metrics.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md138"></a>
Security Model</h2>
<ul>
<li><b>Authentication:</b> Mutual TLS with client certificates (default). Allow token-based auth for web-facing deployments (JWT/OAuth2 bearer tokens).</li>
<li><b>Authorization:</b> Server exports explicit subtrees via capability-aware adapters; actual per-path rights are determined by the hosting application's <span class="tt">Capability</span> object (<span class="tt">can_show</span>, <span class="tt">can_read</span>, <span class="tt">can_write</span>, <span class="tt">can_execute</span>). Deny access outside exported namespace automatically.</li>
<li><b>Encryption:</b> TLS 1.3 with modern ciphers. Optional mTLS or token + TLS depending on deployment.</li>
<li><b>Auditing:</b> Server logs mount attempts, authenticated principals, operations (optional sampling), and data volume. Client logs connection status and mount lifecycle events.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md139"></a>
Protocol Design</h2>
<ul>
<li><b>Transport:</b> Asio-based TLS connections with a lightweight length-prefixed framing. Each frame carries a gzip-compressed JSON payload (UTF-8 before compression) so messages stay debuggable while remaining compact. Evaluate layering HTTP/2/gRPC later if needed.</li>
<li><b>Message format:</b> JSON documents with a <span class="tt">type</span> field (<span class="tt">ReadRequest</span>, <span class="tt">Notification</span>, etc.) plus payload data; compressed with gzip before framing. Include <span class="tt">protocolVersion</span>, <span class="tt">sessionId</span>, and optional <span class="tt">requestId</span> fields for tracking.</li>
<li><b>RPCs:</b><ul>
<li><span class="tt">MountOpen</span>, <span class="tt">MountClose</span></li>
<li><span class="tt">Read</span>, <span class="tt">Insert</span>, <span class="tt">Take</span></li>
<li><span class="tt">List</span> (optional for introspection)</li>
<li><span class="tt">SubscribeNotifications</span> (server streaming)</li>
<li><span class="tt">FetchSnapshotChunk</span> (streaming)</li>
<li><span class="tt">GetDiagnostics</span></li>
</ul>
</li>
<li><b>Error mapping:</b> Map PathSpace errors to gRPC status codes with additional detail (retryable vs not).</li>
<li><b>Versioning:</b> Embed protocol version; server advertises supported range. Define compatibility policy (e.g., N-1).</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md140"></a>
Configuration &amp; Deployment</h2>
<ul>
<li><b>Server config (<span class="tt">distributed_server.toml</span>):</b> exported subtrees, auth mode, TLS certs/keys, listen address, rate limits.</li>
<li><b>Client config (<span class="tt">mounts.toml</span>):</b> remote address, mount path (local), credential reference, retry/backoff policy.</li>
<li><b>Monitoring:</b> metrics for RPC latency, error rates, bytes transferred, active mounts, wait subscriber counts.</li>
<li><b>Scaling:</b> support multiple simultaneous mounts; ensure server can handle concurrent clients with resource limits.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md141"></a>
Dependencies</h2>
<ul>
<li>TLS certificate management (self-signed for dev, ACME/Let’s Encrypt or enterprise CA in prod).</li>
<li>Capability/permission system (PathSpace “Capability” object) must expose <span class="tt">can_show</span>, <span class="tt">can_read</span>, <span class="tt">can_write</span>, <span class="tt">can_execute</span> helpers so the server can evaluate path access without duplicating ACL logic.</li>
<li>Logging enhancements to differentiate local vs remote operations.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md142"></a>
Observability</h2>
<ul>
<li>Expose metrics: RPC latency, error rates, reconnect counts, bytes transferred, pending notification queue size.</li>
<li>Publish structured logs for mount lifecycle events (<span class="tt">MountOpen</span>, <span class="tt">MountClose</span>, disconnects, auth failures).</li>
<li>Future enhancement: once PathSpace adds symlink support, mirror remote diagnostics under convenient local paths via symlinks so tooling/inspectors can read them without custom APIs.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md143"></a>
Plan &amp; Phases</h2>
<ol type="1">
<li><b>Phase 0 — Prototype Mount (single client/server)</b><ul>
<li>Define protobuf/gRPC schemas.</li>
<li>Implement server export of <span class="tt">/users/&lt;user&gt;/system/applications/&lt;app&gt;</span> (read-only).</li>
<li>Implement client mount manager supporting <span class="tt">read</span> and <span class="tt">wait</span>.</li>
<li>Manual tests over localhost with self-signed TLS.</li>
</ul>
</li>
<li><b>Phase 1 — Full Operation Support</b><ul>
<li>Add <span class="tt">insert</span>, <span class="tt">take</span>, batch operations.</li>
<li>Implement wait/notify streaming with proper backpressure.</li>
<li>Add diagnostics mirroring and snapshot fetching.</li>
</ul>
</li>
<li><b>Phase 2 — Security Hardening</b><ul>
<li>mTLS support, configurable ACLs, rate limiting.</li>
<li>Introduce a throttling mount wrapper (PathSpace adapter) that proxies requests to the real tree while tracking usage per session and injecting delays once thresholds are exceeded.</li>
<li>Audit logging and metrics instrumentation.</li>
<li>Robust error handling (retries, exponential backoff, disconnect detection).</li>
</ul>
</li>
<li><b>Phase 3 — Integration &amp; Tooling</b><ul>
<li>Update web server plan to rely on distributed mounts when PathSpace is remote.</li>
<li>Provide CLI (<span class="tt">pathspace mount …</span>) for manual mount management.</li>
<li>Add automated tests (unit, integration with mock server).</li>
</ul>
</li>
<li><b>Phase 4 — Scalability &amp; Features (optional)</b><ul>
<li>Support multiple exported subtrees, partial mounts.</li>
<li>Evaluate caching strategies and diff streaming for high-volume snapshots.</li>
<li>Consider optional compression for large value transfers.</li>
</ul>
</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md144"></a>
Required Documentation Updates</h2>
<ul>
<li><span class="tt"><a class="el" href="_a_i___a_r_c_h_i_t_e_c_t_u_r_e_8md.html">docs/AI_Architecture.md</a></span> — add distributed architecture section.</li>
<li><span class="tt"><a class="el" href="_a_i___p_a_t_h_s_8md.html">docs/AI_Paths.md</a></span> — describe mount path conventions and reserved namespaces (e.g., <span class="tt">/remote/&lt;host&gt;/&lt;mount&gt;</span>).</li>
<li><span class="tt"><a class="el" href="_plan___scene_graph___renderer_8md.html">docs/Plan_SceneGraph_Renderer.md</a></span> / <span class="tt"><a class="el" href="_plan___web_server___adapter_8md.html">docs/Plan_WebServer_Adapter.md</a></span> — reference distributed mounts where relevant.</li>
<li><span class="tt"><a class="el" href="_a_i___debugging___playbook_8md.html">docs/AI_Debugging_Playbook.md</a></span> — troubleshooting steps for network mounts (connectivity, certificate issues).</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md145"></a>
Open Questions</h2>
<ul>
<li><b>Conflict resolution:</b> Do we ever allow multiple writers? If so, what mechanism (last-writer-wins, versioning)?</li>
<li><b>Compression:</b> Default to gzip-compressed JSON frames (already part of the transport design); revisit if we need alternative codecs for large snapshot payloads.</li>
<li><b>Offline behavior:</b> How should clients behave if the mount drops mid-operation (retry vs fail-fast)?</li>
<li><b>Mount discovery:</b> Do we broadcast available exports or rely on explicit configuration?</li>
<li><b>Future multi-writer support:</b> When needed, evaluate CRDT/operation-transform approaches so multiple clients can edit shared subtrees and converge without central locking. Document design implications (including Capability interactions/permissions) before relaxing the single-writer assumption.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md146"></a>
Next Actions</h2>
<ol type="1">
<li>Review and refine requirements with web/renderer stakeholders.</li>
<li>Finalize protocol schema and security requirements.</li>
<li>Add backlog items in <span class="tt">docs/AI_Todo.task</span> for Phase 0 implementation.</li>
<li>Update dependent plans (web server, HTML adapter) to reference distributed mounts. </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
