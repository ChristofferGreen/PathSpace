<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PathSpace: PathSpace HTML Adapter Quickstart &amp; Troubleshooting</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PathSpace
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__2_users_2chrgre01_2src_2_path_space_2docs_2_h_t_m_l___adapter___quickstart.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">PathSpace HTML Adapter Quickstart &amp; Troubleshooting </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md104"></a></p>
<blockquote class="doxtable">
<p><b>Handoff note (October 22, 2025):</b> This guide documents the current HTML adapter harness, HSAT tooling, and common failure signatures so the next session can resume UI verification without rediscovering the workflow. Keep it updated when harness flags, output paths, or diagnostics change. </p>
</blockquote>
<h1 class="doxsection"><a class="anchor" id="autotoc_md105"></a>
1. Prerequisites</h1>
<ul>
<li>Build tree configured in Release mode: <div class="fragment"><div class="line">cmake -S . -B build -DCMAKE_BUILD_TYPE=Release</div>
<div class="line">cmake --build build -j</div>
</div><!-- fragment --></li>
<li>Node.js available on <span class="tt">PATH</span> (required for the headless verification scripts).</li>
<li><span class="tt">build/tests/html_canvas_dump</span> and <span class="tt">build/pathspace_hsat_inspect</span> produced by the build step above.</li>
<li>Optional: set <span class="tt">PATHSPACE_ENABLE_METAL_UPLOADS=1</span> when you explicitly want GPU uploads during local HTML runs; the harness defaults to the software path so runs stay deterministic.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md106"></a>
2. HTML Adapter Quickstart</h1>
<ol type="1">
<li><b>Run the headless replay harness (Canvas + DOM parity):</b> <div class="fragment"><div class="line">ctest -R HtmlCanvasVerify --output-on-failure</div>
</div><!-- fragment --><ul>
<li>Executes <span class="tt">scripts/verify_html_canvas.js</span> against <span class="tt">html_canvas_dump</span>.</li>
<li>Scenarios covered: <span class="tt">widgets-default</span> (default theme) and <span class="tt">widgets-sunset</span> (alternate palette). Colors, command ordering, radii, and structural fields must match the native renderer output.</li>
<li>Automatically skips (exit code 0) when Node.js is unavailable; treat the skip as a warning and install Node before the next loop run.</li>
</ul>
</li>
<li><b>Inspect HSAT payload decoding:</b> <div class="fragment"><div class="line">ctest -R HtmlAssetInspect --output-on-failure</div>
</div><!-- fragment --><ul>
<li>Invokes <span class="tt">scripts/verify_hsat_assets.js &lt;build/pathspace_hsat_inspect&gt;</span>.</li>
<li>Generates a synthetic HSAT payload, confirms magic/version (<span class="tt">0x48534154</span>, <span class="tt">0x0001</span>), validates MIME-specific kind detection, and checks byte previews/reference flags.</li>
</ul>
</li>
<li><b>Manual spot-check:</b> <div class="fragment"><div class="line">node scripts/verify_html_canvas.js build/tests/html_canvas_dump</div>
<div class="line">node scripts/verify_hsat_assets.js build/pathspace_hsat_inspect</div>
</div><!-- fragment --> Use the manual commands when debugging a single harness without running the full CTest suite. Pass <span class="tt">--prefer-dom</span> or <span class="tt">--scenario basic|widgets-default|widgets-sunset</span> to <span class="tt">html_canvas_dump</span> to narrow the reproduction.</li>
<li><b>Review adapter outputs in PathSpace:</b><ul>
<li>Command stream and DOM/CSS live under <span class="tt">renderers/&lt;rid&gt;/targets/&lt;tid&gt;/output/v1/html/{commands,dom,css}</span>.</li>
<li>Mode metadata: <span class="tt">output/v1/html/{mode,usedCanvasFallback,commandCount,domNodeCount}</span>.</li>
<li>Residency/metrics mirror into <span class="tt">renderers/&lt;rid&gt;/targets/&lt;tid&gt;/diagnostics/metrics</span> and <span class="tt">windows/&lt;win&gt;/diagnostics/metrics/live/views/&lt;view&gt;/present</span>.</li>
</ul>
</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md107"></a>
3. Common Failure Signatures &amp; Fixes</h1>
<ul>
<li><b><span class="tt">Usage: node verify_html_canvas.js &lt;html-canvas-dump&gt;</span></b> — The harness could not locate <span class="tt">html_canvas_dump</span>. Rebuild the tree (<span class="tt">cmake --build build -j</span>) and ensure you pass the binary path (CTest does this automatically).</li>
<li><b>&lsquo;Invocation 'html_canvas_dump …&rsquo; produced no output`</b> — The helper crashed or could not publish a snapshot. Re-run <span class="tt">html_canvas_dump</span> manually with <span class="tt">--scenario basic</span> and inspect stderr; verify the builders can author scenes (<span class="tt">ctest -R PathSpaceUITests --output-on-failure</span>).</li>
<li><b><span class="tt">missing color</span> / <span class="tt">expected rgba(...)</span> errors</b> — Theme digests diverged. Confirm the widgets gallery produces the expected colors by rerunning <span class="tt">html_canvas_dump --scenario widgets-default</span> and diffing the generated JSON against <span class="tt">build/test-logs/html_canvas_dump_*.json</span>. Recent style changes require updating both the renderer palette and the DOM compositor.</li>
<li><b><span class="tt">Canvas command array is empty</span> or structural field assertions</b> — Typically indicates a regression in <span class="tt">SceneSnapshotBuilder</span> or adapter traversal. Check <span class="tt">renderers/&lt;rid&gt;/targets/&lt;tid&gt;/output/v1/common/frameIndex</span> to confirm the render completed, then inspect <span class="tt">scenes/&lt;sid&gt;/builds/&lt;rev&gt;/drawables</span> for missing buckets.</li>
<li><b><span class="tt">usedCanvasFallback=true</span> unexpectedly</b> — DOM mode exceeded <span class="tt">HtmlTargetDesc::max_dom_nodes</span> or DOM emission failed. Increase <span class="tt">max_dom_nodes</span>, set <span class="tt">allow_canvas_fallback=false</span> during local testing to surface a hard error, and watch <span class="tt">diagnostics/errors/live</span> for adapter error details.</li>
<li><b>HSAT decode errors (<span class="tt">magic mismatch</span>, <span class="tt">assetCount</span> mismatch)</b> — Generated payload is stale or corrupted. Regenerate by rerunning any HTML present (e.g., <span class="tt">html_canvas_dump</span>), then re-run <span class="tt">pathspace_hsat_inspect --input &lt;payload.hsat&gt;</span> to confirm the header and per-asset lengths. If assets are missing bytes, verify <span class="tt">Renderer::RenderHtml</span> publishes hydrated payloads under <span class="tt">output/v1/html/assets/*</span>.</li>
<li><b><span class="tt">HSAT inspection verified</span> missing or Node exits with <span class="tt">ENOENT</span></b> — Node.js not installed or not on <span class="tt">PATH</span>. Install Node ≥18 or adjust your environment; without it the HSAT harness is skipped and gaps may hide.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md108"></a>
4. Workflow Reminders</h1>
<ul>
<li>Always rerun the full loop before handoff: <div class="fragment"><div class="line">./scripts/compile.sh --test --loop=15 --per-test-timeout=20</div>
</div><!-- fragment --> This wrapper will also trigger <span class="tt">HtmlCanvasVerify</span> and <span class="tt">HtmlAssetInspect</span> when Node is available.</li>
<li>When HTML outputs change intentionally, update:<ol type="1">
<li><span class="tt"><a class="el" href="_plan___scene_graph___renderer_8md.html">docs/Plan_SceneGraph_Renderer.md</a></span> (fidelity, HSAT schema, mode semantics).</li>
<li><span class="tt"><a class="el" href="_plan___scene_graph___implementation_8md.html">docs/Plan_SceneGraph_Implementation.md</a></span> (status snapshot + follow-ups).</li>
<li>This quickstart with new commands, environment variables, or failure signatures.</li>
</ol>
</li>
<li>Capture notable regressions in <span class="tt">docs/AI_Todo.task</span> with acceptance criteria so the next cycle can prioritize the fix.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md109"></a>
5. Related Tools &amp; References</h1>
<ul>
<li><span class="tt">tests/tools/html_canvas_dump.cpp</span> — Generates deterministic scenes for the harness.</li>
<li><span class="tt">scripts/verify_html_canvas.js</span> — Parity checker for DOM/CSS/Canvas outputs (themes, geometry, assets).</li>
<li><span class="tt">tools/hsat_inspect.cpp</span> — HSAT decoder used by both the CLI and verification script.</li>
<li><span class="tt"><a class="el" href="_a_i___debugging___playbook_8md.html">docs/AI_Debugging_Playbook.md</a></span> §5 — Command reference for running the harnesses alongside the standard test loop.</li>
<li><span class="tt"><a class="el" href="_plan___scene_graph___renderer_8md.html">docs/Plan_SceneGraph_Renderer.md</a></span> — Source of truth for adapter options (<span class="tt">prefer_dom</span>, <span class="tt">max_dom_nodes</span>, <span class="tt">allow_canvas_fallback</span>) and HSAT framing details.</li>
</ul>
<p>Keep this document lightweight but current—future render/adapter changes should land here first so incoming maintainers can validate HTML fidelity without spelunking. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
