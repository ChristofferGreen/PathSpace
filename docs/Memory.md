## Repository Memory
This file is for remembering architecture details about the PathSPace project so it becomes easier to get up to speed about details later.
No need to store details about a worklog of dates when things where added.

- 2025-11-18: WidgetEventTrellis mutates declarative widget state (button hover/press, toggle checked, slider value/dragging, list hover/selection, tree hover/expanded) and flips `render/dirty` before emitting each `WidgetOp`, so declarative apps stay in sync without handlers touching `widgets/<id>/state/*`.
- 2025-11-18: Keyboard + gamepad navigation calls `Widgets::Focus::Move` (Tab/Shift+Tab or shoulder/D-pad hops) to rewrite `<app>/widgets/focus/current`, and InputTask exposes per-widget handler telemetry at `widgets/<id>/metrics/handlers/{invoked_total,failures_total,missing_total}` to pinpoint flaky/missing callbacks; slider/list/tree arrow routing is still pending inside WidgetEventTrellis.
- 2025-11-18: Declarative paint surfaces persist `state/history/<stroke-id>/{meta,points}`, track `render/buffer/revision`, queue `DirtyRectHint`s under `render/buffer/pendingDirty` + `/render/gpu/dirtyRects`, and let the `/system/widgets/runtime/paint_gpu` uploader rasterize stroke history into `assets/texture` while SceneLifecycle forwards pending rectangles to renderer hints.
- 2025-11-18: Declarative paint-surface tests must shut down the runtime after launching (`RuntimeGuard`) to avoid leaving worker threads around for subsequent suites.
- 2025-11-18: `WidgetFragment` now carries handler specs; `Widgets::Mount` rebinds them automatically and `Widgets::Handlers::{Read,Replace,Wrap,Restore}` exposes a supported way to intercept or restore declarative callbacks without poking raw `events/<event>/handler` nodes.
- 2025-11-18: Theme resolver now walks `config/theme/<name>/style/inherits` (depth cap 16), falls back to the nearest ancestor that stores a `WidgetTheme` payload, and errors on cycles; edits are picked up automatically the next time descriptors read the theme.
- 2025-11-18: WidgetEventTrellis now falls back to `<app>/widgets/focus/current` when per-scene focus mirrors are missing and routes keyboard/gamepad Space/Enter/A/A-button presses into the same Press/Release/Activate/Toggle ops as pointer clicks for focused buttons/toggles; slider/list/tree arrow handling remains TODO.
